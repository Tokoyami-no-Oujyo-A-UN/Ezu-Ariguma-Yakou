<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>キャラクター横スクロール</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  height: 100%;
  width: 100%;
  touch-action: pan-y;
  -webkit-user-select: none;
  -webkit-tap-highlight-color: transparent;
}

/* レイヤー1: 背景 */
#container {
  position: relative;
  width: 100%;
  height: 100%;
  background: url('bg.jpg') no-repeat center center fixed;
  background-size: cover;
  overflow-x: scroll;
  overflow-y: hidden;
  white-space: nowrap;
  scroll-behavior: smooth;
}

/* レイヤー2: 雲 */
.cloud {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  height: 100%;
  z-index: 2;
  pointer-events: none;
}

/* レイヤー3: キャラクター画像 */
#charWrapper {
  display: inline-block;
  height: 100%;
  position: relative;
  z-index: 3;
}

.charImg {
  display: inline-block;
  height: 100%;
  cursor: pointer;
}

/* レイヤー4: 詳細テキストボックス（画面中央・幅90%固定） */
#txtBox {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 800px; /* 任意のPixel上限 */
  background-color: #000;
  color: #fff;
  padding: 10px;
  box-sizing: border-box;
  z-index: 4;
  display: none;
}

/* レイヤー5: 下部左右ナビリンク */
#navLinks {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  z-index: 5;
  text-align: center;
}
#prevChar, #nextChar {
  display: inline-block;
  height: 50px;
  cursor: pointer;
}
#prevChar { width: 40%; float: left; }
#nextChar { width: 40%; float: right; }
#navCenter { width: 20%; display:inline-block; height:50px; } /* 中央タップでtxt表示 */
</style>
</head>
<body>
<div id="container">
  <!-- レイヤー2: 雲 -->
  <img id="cloud" class="cloud" src="">

  <!-- レイヤー3: キャラクター画像 -->
  <div id="charWrapper"></div>

  <!-- レイヤー4: 詳細テキストボックス -->
  <div id="txtBox"></div>
  
  <!-- レイヤー5: 下部ナビリンク -->
  <div id="navLinks">
    <a href="#" id="prevChar"></a>
    <a href="#" id="navCenter"></a>
    <a href="#" id="nextChar"></a>
  </div>
</div>

<script>
// キャラクターマップ
var charMap = {
  1: { img:"01.png", kumo:"kumo_b.png", txt:"01.txt" },
  2: { img:"02.png", kumo:"kumo_k.png", txt:"02.txt" },
  3: { img:"03.png", kumo:"kumo_w.png", txt:"03.txt" },
  4: { img:"04.png", kumo:"kumo_b.png", txt:"04.txt" }
};

var charWrapper = document.getElementById('charWrapper');
var txtBox = document.getElementById('txtBox');
var cloudImg = document.getElementById('cloud');
var container = document.getElementById('container');
var currentIndex = 1;

// キャラクター生成
for(var key in charMap){
  if(charMap.hasOwnProperty(key)){
    var c = charMap[key];
    var img = document.createElement('img');
    img.src = c.img;
    img.className = 'charImg';
    img.setAttribute('data-key', key);
    img.onclick = function(e){
      e.stopPropagation();
      currentIndex = parseInt(this.getAttribute('data-key'));
      showText(currentIndex);
      updateCloud(currentIndex);
    };
    charWrapper.appendChild(img);
  }
}

// 初期雲
updateCloud(currentIndex);

// ウィンドウサイズ調整
function adjustHeight(){
  var h = window.innerHeight;
  var imgs = document.getElementsByClassName('charImg');
  for(var i=0;i<imgs.length;i++){
    imgs[i].style.height = h+'px';
  }
  cloudImg.style.height = h+'px';
}
window.onresize = adjustHeight;
adjustHeight();

// 中央画面にテキスト表示
function showText(index){
  var xhr = new XMLHttpRequest();
  xhr.open('GET', charMap[index].txt, true);
  xhr.onreadystatechange = function(){
    if(xhr.readyState==4 && xhr.status==200){
      txtBox.innerText = xhr.responseText;
      txtBox.style.display = 'block';
    }
  };
  xhr.send();
}

// テキスト非表示
txtBox.onclick = function(){ this.style.display='none'; };

// 横スクロール
function scrollToChar(index){
  var target = charWrapper.querySelector('img[data-key="'+index+'"]');
  if(target){
    container.scrollLeft = target.offsetLeft;
    updateCloud(index);
  }
}

// 雲切替
function updateCloud(index){
  cloudImg.src = charMap[index].kumo;
}

// 下部リンク操作
document.getElementById('prevChar').onclick = function(e){
  e.preventDefault();
  if(currentIndex > 1){
    currentIndex--;
    scrollToChar(currentIndex);
  }
};
document.getElementById('nextChar').onclick = function(e){
  e.preventDefault();
  if(currentIndex < Object.keys(charMap).length){
    currentIndex++;
    scrollToChar(currentIndex);
  }
};
document.getElementById('navCenter').onclick = function(e){
  e.preventDefault();
  showText(currentIndex);
};

// タッチ操作で横スクロール
var startX = 0;
var isTouching = false;
container.addEventListener('touchstart', function(e){
  startX = e.touches[0].pageX;
  isTouching = true;
});
container.addEventListener('touchmove', function(e){
  if(!isTouching) return;
  var dx = startX - e.touches[0].pageX;
  container.scrollLeft += dx;
  startX = e.touches[0].pageX;
});
container.addEventListener('touchend', function(e){ isTouching=false; });
</script>
</body>
</html>
