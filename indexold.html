<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>キャラクター横スクロール</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  height: 100%;
  width: 100%;
  touch-action: pan-y;
  -webkit-user-select: none;
  -webkit-tap-highlight-color: transparent;
}

#container {
  position: relative;
  width: 100%;
  height: 100%;
  background: url('bg.jpg') no-repeat center center fixed;
  background-size: cover;
  overflow-x: scroll;
  overflow-y: hidden;
  white-space: nowrap;
  scroll-behavior: smooth;
}

.cloud {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  height: 100%;
  z-index: 2;
  pointer-events: none;
}

#charWrapper {
  display: inline-block;
  height: 100%;
  position: relative;
}

.charImg {
  display: inline-block;
  vertical-align: top;
  height: 100%;
  cursor: pointer;
}

#txtBox {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  background-color: rgba(0,0,0,0.7);
  color: #fff;
  padding: 10px;
  box-sizing: border-box;
  z-index: 4;
  display: none;
  overflow-y: auto;
  max-height: 100%;
}

.navZone {
  position: absolute;
  top: 0;
  height: 100%;
  width: 20%;
  z-index: 5;
}

#leftZone {
  left: 0;
}

#rightZone {
  right: 0;
}
</style>
</head>
<body>
<div id="container">
  <img id="cloud" class="cloud" src="">
  <div id="charWrapper"></div>
  <div id="txtBox"></div>
  <div id="leftZone" class="navZone"></div>
  <div id="rightZone" class="navZone"></div>
</div>

<script>
// キャラクターマップ
var charMap = {
  1: { img:"01.png", kumo:"kumo_b.png", txt:"01.txt" },
  2: { img:"02.png", kumo:"kumo_k.png", txt:"02.txt" },
  3: { img:"03.png", kumo:"kumo_w.png", txt:"03.txt" },
  4: { img:"04.png", kumo:"kumo_b.png", txt:"04.txt" }
  // 必要に応じて追加
};

var charWrapper = document.getElementById('charWrapper');
var txtBox = document.getElementById('txtBox');
var cloudImg = document.getElementById('cloud');
var container = document.getElementById('container');
var currentIndex = 1;

// キャラクター画像生成
for(var key in charMap){
  if(charMap.hasOwnProperty(key)){
    var c = charMap[key];
    var img = document.createElement('img');
    img.src = c.img;
    img.className = 'charImg';
    img.setAttribute('data-key', key);
    img.onclick = function(e){
      e.stopPropagation();
      var k = this.getAttribute('data-key');
      loadText(k);
    };
    charWrapper.appendChild(img);
  }
}

// 初期雲
updateCloud(currentIndex);

// ウィンドウサイズに合わせて高さ調整
function adjustHeight(){
  var h = window.innerHeight;
  var imgs = document.getElementsByClassName('charImg');
  for(var i=0;i<imgs.length;i++){
    imgs[i].style.height = h+'px';
  }
  cloudImg.style.height = h+'px';
}
window.onresize = adjustHeight;
adjustHeight();

// テキスト読み込み
function loadText(index){
  var xhr = new XMLHttpRequest();
  xhr.open('GET', charMap[index].txt, true);
  xhr.onreadystatechange = function(){
    if(xhr.readyState==4 && xhr.status==200){
      txtBox.innerText = xhr.responseText;
      txtBox.style.display = 'block';
    }
  };
  xhr.send();
}

// テキスト非表示
txtBox.onclick = function(){ this.style.display='none'; };

// ナビ操作
document.getElementById('leftZone').onclick = function(e){
  e.stopPropagation();
  if(currentIndex>1){ currentIndex--; scrollToChar(currentIndex); }
};

document.getElementById('rightZone').onclick = function(e){
  e.stopPropagation();
  if(currentIndex<Object.keys(charMap).length){ currentIndex++; scrollToChar(currentIndex); }
};

// 中央タップで詳細表示
container.onclick = function(e){
  if(e.target.id==='container'){
    loadText(currentIndex);
  }
};

// キャラクター位置にスクロール
function scrollToChar(index){
  var target = charWrapper.querySelector('img[data-key="'+index+'"]');
  if(target){
    container.scrollLeft = target.offsetLeft;
    updateCloud(index);
  }
}

// 雲切替
function updateCloud(index){
  cloudImg.src = charMap[index].kumo;
}

// タッチ操作で横スクロール（簡易スワイプ）
var startX = 0;
var isTouching = false;
container.addEventListener('touchstart', function(e){
  startX = e.touches[0].pageX;
  isTouching = true;
});
container.addEventListener('touchmove', function(e){
  if(!isTouching) return;
  var dx = startX - e.touches[0].pageX;
  container.scrollLeft += dx;
  startX = e.touches[0].pageX;
});
container.addEventListener('touchend', function(e){ isTouching=false; });

</script>
</body>
</html>
