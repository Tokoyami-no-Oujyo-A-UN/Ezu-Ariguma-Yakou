<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>旧端末用キャラクター巻物UI</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow-x: auto;
  overflow-y: hidden;
  font-family: sans-serif;
  height: 100%;
  white-space: nowrap;
}

#background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: url("bg.jpg");
  background-size: cover;
  z-index: 0;
}

#scroll-container {
  position: relative;
  height: 100%;
}

.item {
  display: inline-block;
  vertical-align: top;
  position: relative;
  text-align: center;
}

.item img.character {
  display: block;
  height: 100vh; /* ブラウザ縦サイズ */
}

.item img.kumo {
  position: absolute;
  top: 0;
  left: 0;
  height: 100vh;
  z-index: 1;
}

.nav-btn {
  display: inline-block;
  margin: 0 7px;
  cursor: pointer;
}

#detail-panel {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  max-height: 40%;
  background-color: rgba(0,0,0,0.7);
  color: #fff;
  padding: 10px;
  overflow-y: auto;
  display: none;
  z-index: 100;
}

#detail-close {
  position: absolute;
  top: 5px;
  right: 5px;
  width: 30px;
  height: 30px;
  cursor: pointer;
}
</style>
</head>
<body>

<div id="background"></div>
<div id="scroll-container"></div>

<div id="detail-panel">
  <div id="detail-close"><img src="0moji_cl.png" style="width:100%; height:100%;"></div>
  <div id="detail-text"></div>
</div>

<script>
// キャラクターマップ
const charMap = {
  1: { img:"01.png", kumo:"kumo_b.png", txt:"01.txt" },
  2: { img:"02.png", kumo:"kumo_k.png", txt:"02.txt" },
  3: { img:"03.png", kumo:"kumo_w.png", txt:"03.txt" },
  4: { img:"04.png", kumo:"kumo_b.png", txt:"04.txt" }
};

const scrollContainer = document.getElementById('scroll-container');
const detailPanel = document.getElementById('detail-panel');
const detailText = document.getElementById('detail-text');
const detailClose = document.getElementById('detail-close');

let currentIndex = Object.keys(charMap).length;
let txtOpen = false;

// キャラクター DOM 生成
for (let i = 1; i <= Object.keys(charMap).length; i++) {
  const div = document.createElement('div');
  div.className = 'item';
  div.id = 'char-' + i;

  const kumoImg = document.createElement('img');
  kumoImg.src = charMap[i].kumo;
  kumoImg.className = 'kumo';
  div.appendChild(kumoImg);

  const charImg = document.createElement('img');
  charImg.src = charMap[i].img;
  charImg.className = 'character';
  div.appendChild(charImg);

  // ナビボタン
  const btnPrev = document.createElement('img');
  btnPrev.src = '0left.png';
  btnPrev.className = 'nav-btn';
  btnPrev.onclick = () => scrollToChar(i-1);
  div.appendChild(btnPrev);

  const btnNext = document.createElement('img');
  btnNext.src = '0right.png';
  btnNext.className = 'nav-btn';
  btnNext.onclick = () => scrollToChar(i+1);
  div.appendChild(btnNext);

  const btnDetail = document.createElement('img');
  btnDetail.src = '0moji_op.png';
  btnDetail.className = 'nav-btn';
  btnDetail.onclick = () => toggleDetail(i);
  div.appendChild(btnDetail);

  scrollContainer.appendChild(div);
}

// スクロール関数
function scrollToChar(index) {
  if(index < 1) index = 1;
  if(index > Object.keys(charMap).length) index = Object.keys(charMap).length;
  const target = document.getElementById('char-' + index);
  if(target) target.scrollIntoView({behavior:'auto', inline:'start'});
  currentIndex = index;
  closeDetail();
  updateKumo(index);
}

// 雲切替（即時）
function updateKumo(index) {
  const items = document.querySelectorAll('.item');
  items.forEach(item => {
    const kumoImg = item.querySelector('.kumo');
    kumoImg.style.display = (item.id === 'char-' + index) ? 'block' : 'none';
  });
}

// 詳細テキスト表示
function toggleDetail(index) {
  if(txtOpen) { closeDetail(); return; }
  txtOpen = true;
  const txtFile = charMap[index].txt;
  fetch(txtFile)
    .then(res => res.text())
    .then(data => {
      detailText.innerText = data;
      detailPanel.style.display = 'block';
    });
}

function closeDetail() {
  txtOpen = false;
  detailPanel.style.display = 'none';
  detailText.innerText = '';
}

// 閉じるボタン
detailClose.addEventListener('click', closeDetail);

// 初期表示
window.addEventListener('load', () => {
  scrollToChar(currentIndex);
});
</script>
</body>
</html>
