<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>キャラクター横スクロール</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  overflow: hidden;
  touch-action: pan-y;
  -webkit-user-select: none;
  -webkit-tap-highlight-color: transparent;
}

/* レイヤー1: 背景 */
#container {
  position: relative;
  width: 100%;
  height: 100%;
  background: url('bg.jpg') no-repeat center center fixed;
  background-size: cover;
  overflow-x: scroll;
  overflow-y: hidden;
  white-space: nowrap;
  scroll-behavior: smooth;
}

/* レイヤー2: 雲（固定） */
.cloud {
  position: fixed;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  height: 100%;
  z-index: 2;
  pointer-events: none;
}

/* レイヤー3: キャラクター画像 */
#charWrapper {
  display: inline-block;
  height: 100%;
  position: relative;
  z-index: 3;
}

.charImg {
  display: inline-block;
  height: 100%;
  cursor: pointer;
}

/* レイヤー4: 全画面テキストボックス */
#txtBox {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.9);
  color: #fff;
  padding: 20px;
  box-sizing: border-box;
  z-index: 100;
  display: none;
  overflow-y: auto;
  white-space: pre-wrap;
}

/* 左右20%タップ領域 */
.sideTap {
  position: fixed;
  top: 0;
  width: 20%;
  height: 100%;
  z-index: 50;
  cursor: pointer;
}
#leftTap { left: 0; }
#rightTap { right: 0; }

/* 中央タップ用リンク */
#navCenter {
  position: fixed;
  top: 0;
  left: 20%;
  width: 60%;
  height: 100%;
  z-index: 40;
}
</style>
</head>
<body>
<div id="container">
  <!-- レイヤー2: 雲 -->
  <img id="cloud" class="cloud" src="">

  <!-- レイヤー3: キャラクター画像 -->
  <div id="charWrapper"></div>

  <!-- レイヤー4: 全画面テキストボックス -->
  <div id="txtBox"></div>

  <!-- 左右タップ領域 -->
  <div id="leftTap" class="sideTap"></div>
  <div id="rightTap" class="sideTap"></div>

  <!-- 中央タップ領域 -->
  <div id="navCenter"></div>
</div>

<script>
// キャラクターマップ
var charMap = {
  1: { img:"01.png", kumo:"kumo_b.png", txt:"01.txt" },
  2: { img:"02.png", kumo:"kumo_k.png", txt:"02.txt" },
  3: { img:"03.png", kumo:"kumo_w.png", txt:"03.txt" },
  4: { img:"04.png", kumo:"kumo_b.png", txt:"04.txt" }
};

var charWrapper = document.getElementById('charWrapper');
var txtBox = document.getElementById('txtBox');
var cloudImg = document.getElementById('cloud');
var container = document.getElementById('container');
var currentIndex = 1;

// キャラクター生成
for(var key in charMap){
  if(charMap.hasOwnProperty(key)){
    var c = charMap[key];
    var img = document.createElement('img');
    img.src = c.img;
    img.className = 'charImg';
    img.setAttribute('data-key', key);
    img.onclick = function(e){
      e.stopPropagation();
      currentIndex = parseInt(this.getAttribute('data-key'));
      showText(currentIndex);
      updateCloud(currentIndex);
    };
    charWrapper.appendChild(img);
  }
}

// 初期雲
updateCloud(currentIndex);

// ウィンドウサイズ調整
function adjustHeight(){
  var h = window.innerHeight;
  var imgs = document.getElementsByClassName('charImg');
  for(var i=0;i<imgs.length;i++){
    imgs[i].style.height = h+'px';
  }
  cloudImg.style.height = h+'px';
}
window.onresize = adjustHeight;
adjustHeight();

// 中央タップで全画面テキスト表示・再タップで閉じる
function showText(index){
  if(txtBox.style.display === 'block'){
    txtBox.style.display = 'none';
    return;
  }

  var xhr = new XMLHttpRequest();
  xhr.open('GET', charMap[index].txt, true);
  xhr.onreadystatechange = function(){
    if(xhr.readyState==4 && xhr.status==200){
      txtBox.innerText = xhr.responseText;
      txtBox.style.display = 'block';
    }
  };
  xhr.send();
}

// テキスト再タップで非表示
txtBox.onclick = function(){ this.style.display='none'; };

// 横スクロール
function scrollToChar(index){
  var target = charWrapper.querySelector('img[data-key="'+index+'"]');
  if(target){
    container.scrollLeft = target.offsetLeft;
  }
}

// 雲切替（固定表示なのでスクロール連動なし）
function updateCloud(index){
  cloudImg.src = charMap[index].kumo;
}

// 左右タップ（touch対応）
document.getElementById('leftTap').addEventListener('touchstart', function(e){
  e.preventDefault();
  if(txtBox.style.display !== 'block' && currentIndex > 1){
    currentIndex--;
    scrollToChar(currentIndex);
    updateCloud(currentIndex);
  }
}, {passive:false});

document.getElementById('rightTap').addEventListener('touchstart', function(e){
  e.preventDefault();
  if(txtBox.style.display !== 'block' && currentIndex < Object.keys(charMap).length){
    currentIndex++;
    scrollToChar(currentIndex);
    updateCloud(currentIndex);
  }
}, {passive:false});

// 中央タップでテキスト表示
document.getElementById('navCenter').addEventListener('touchstart', function(e){
  e.preventDefault();
  showText(currentIndex);
}, {passive:false});

// スワイプ操作で横スクロール
var startX = 0;
var isTouching = false;
container.addEventListener('touchstart', function(e){
  startX = e.touches[0].pageX;
  isTouching = true;
});
container.addEventListener('touchmove', function(e){
  if(!isTouching) return;
  var dx = startX - e.touches[0].pageX;
  container.scrollLeft += dx;
  startX = e.touches[0].pageX;
});
container.addEventListener('touchend', function(e){ isTouching=false; });
</script>
</body>
</html>
